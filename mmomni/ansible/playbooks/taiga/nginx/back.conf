# Backend
location /taiga/api {
    proxy_set_header Host $http_host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Scheme $scheme;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_pass http://127.0.0.1:8001/api;
    proxy_redirect off;
}

# Django admin access (/admin/)
location /taiga/admin {
    proxy_set_header Host $http_host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Scheme $scheme;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_pass http://127.0.0.1:8001$request_uri;
    proxy_redirect off;
}
# Static files
location /taiga/static {
    alias {{ taiga_back_root }}/static;
}

## Taiga-events
#location /taiga/events {
#    proxy_pass http://127.0.0.1:8888/events;
#    proxy_http_version 1.1;
#    proxy_set_header Upgrade $http_upgrade;
#    proxy_set_header Connection "upgrade";
#    proxy_connect_timeout 7d;
#    proxy_send_timeout 7d;
#    proxy_read_timeout 7d;
#}

location /_protected {
    internal;
    alias {{ taiga_back_media }}/;
    add_header Content-disposition "attachment";
}

# Unprotected section
location /taiga/media/exports {
    alias {{ taiga_back_media }}/exports/;
    add_header Content-disposition "attachment";
}
location /taiga/media {
    proxy_set_header Host $http_host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Scheme $scheme;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_pass http://127.0.0.1:8002/;
    proxy_redirect off;
}
